
# Aptos Project Indexer

## Overview

This project is designed to index transactions from the Aptos blockchain. The indexer processes the latest blockchain transactions, extracts relevant data, and updates the database accordingly.

## Supported Protocols

Currently, this indexer supports the following 4 protocols:

1. **Liquidswap**
2. **Thalaswap**
3. **Pancakeswap**
4. **SushiSwap**

The indexer fetches transaction data from these protocols to compute and track key metrics associated with liquidity pools and their activities.

## Calculated Metrics

After processing the data, the indexer calculates and tracks the following metrics for each pool:

1. **TVL (Total Value Locked)**: The total value of assets held in the liquidity pool.
2. **Volume**: 
   - **Daily Volume**: The total trading volume for the pool in the last 24 hours.
   - **Weekly Volume**: The total trading volume for the pool over the last 7 days.
   - **Monthly Volume**: The total trading volume for the pool over the last 30 days.
3. **Fees**: 
   - **Daily Fees**: The total fees generated by the pool in the last 24 hours.
   - **Weekly Fees**: The total fees generated by the pool in the last 7 days.
   - **Monthly Fees**: The total fees generated by the pool in the last 30 days.
4. **Slippage**: The median slippage values for the pool over different time frames:
   - **1 Day**: Median slippage for the past 24 hours.
   - **7 Days**: Median slippage for the past week.
   - **30 Days**: Median slippage for the past month.
5. **Pool Name**: The name of the pool (e.g., the liquidity pair or a custom name provided by the protocol).

These values are updated continuously as the indexer fetches and processes the latest transactions from the blockchain.

## Prerequisites

1. **Install Poetry**: This project uses Poetry for dependency management. If you don't have it installed, follow the [Poetry installation guide](https://python-poetry.org/docs/#installation).
2. **Set Up Database**: A PostgreSQL database is required to store transaction data.

## Setting Up the Environment

To run the application, you need to create a `.env` file in the root directory of the project with the following structure:

### `.env` File Structure

```plaintext
DB_STRING=postgresql://<username>:<password>@<host>:<port>/<database>
CONFIG=config.yaml
RPC_URL=<rpc_url_for_blockchain>
AUTH_TOKEN=<auth_token>
PANORA_API_KEY=<api_key>
```

#### Explanation of Variables:
- **`DB_STRING`**: Connection string for the PostgreSQL database.
- **`CONFIG`**: Path to the configuration file used by the application.
- **`RPC_URL`**: URL of the Aptos blockchain full node.
- **`AUTH_TOKEN`**: Authorization token for aptos transaction stream service.
- **`PANORA_API_KEY`**: API key for accessing Panora services.

## Installing Dependencies

1. Install the required dependencies using **Poetry**:
   ```bash
   poetry install
   ```

2. Install the necessary npm dependencies (if applicable):
   ```bash
   npm install
   ```

   This will install all necessary JavaScript dependencies for the project.

## Running the Indexer

1. Start the indexer using Poetry and the appropriate configuration:
   ```bash
   poetry run python -m processors.main -c config.yaml
   ```

   The indexer initializes by fetching the **latest transaction** from the Aptos blockchain, ensuring the most up-to-date data is processed.
